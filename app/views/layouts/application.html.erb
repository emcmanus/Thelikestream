<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
         "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
         
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

    <% unless @html_title.blank? %>
        <title><% if RAILS_ENV == "development" %> DEV - <% end %>TheLikeStream - <%= @html_title %></title>
    <% else %>
        <title><% if RAILS_ENV == "development" %> DEV - <% end %>TheLikeStream - <%= controller.controller_name.titleize %></title>
    <% end %>

    <%= javascript_include_tag :defaults %>

    <%= stylesheet_link_tag 'blueprint/screen', :media => "screen, projection" %>
    <%= stylesheet_link_tag 'blueprint/print', :media => "print" %>
    <!--[if lt IE 8]>
        <%= stylesheet_link_tag 'blueprint/ie', :media => "screen, projection" %>
    <![endif]-->
    <%= stylesheet_link_tag 'application' %>

    <!-- OpenGraph Meta Tags -->
    <%= render :partial => '/layouts/ogTags' %>
    
    
    <%= yield :head %>
    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-18470624-1']);
      _gaq.push(['_setDomainName', '.thelikestream.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
</head>

<body>
    
<% unless @empty_layout %>
	<script type="text/javascript" charset="utf-8">
	    if (!window.queuedFacebookCalls) window.queuedFacebookCalls = [];
	   function facebookApiReady()
	   {
	       if (window.queuedFacebookCalls.length)
	       {
	           var proc;
	           while ( proc = window.queuedFacebookCalls.pop() )
	           {
	               proc();
               }
	       }
	   }
	   function fbSafe(func){
	       window.queuedFacebookCalls.push(func);
	   }
	   function writeLikeButton(targetId, encodedLink)
       {
           $(targetId).innerHTML = '<fb:like layout="button_count" show_faces="no" href="'+encodedLink+'"></fb:like>';
           if (typeof FB != "undefined")
           {
               FB.XFBML.parse($(targetId));
           }
       }
	</script>
    <% if @page and @page.is_cloaked %>
        <% fb_connect_async_js :app_id=>"157023087646197" do -%>
			facebookApiReady();
		<% end %>
    <% else %>
        <% fb_connect_async_js do -%>
			facebookApiReady();
		<% end %>
    <% end %>
    
    <style type="text/css" media="screen">
        .nav_link.current {
                background-color: #000;
                color: white;
                padding: 0 3px;
                margin: 0 2px;
                font-weight: bold; letter-spacing: -1px; font-size:1.3em;
        }
        .nav_link {
            background-color: #ffff00;
            padding: 0 3px;
            margin: 0 2px;
            font-weight: bold; letter-spacing: -1px; font-size:1.3em;
            cursor: pointer;
        }
        a.nav_link { 
            color: black;
            text-decoration: none;
        }
        .nav_link:hover {
            background-color: #000;
            color: white;
        }
        a.mainlink {
            text-decoration: none;
            color: #333;
        }
        a.mainlink:hover {
            text-decoration: none;
            color: #000;
        }
    </style>

<% if get_unpublished_pages %>
    <%= render :partial=>'/layouts/unpublishedBanner' %>
<% end %>


    
<div class="container" style="margin-top: 10px;">
    
    <% unless current_user.blank? %>
    
        <% if current_user.is_content_editor %>
            <div class="prepend-1 span-22 append-1 last" style="background-color: white; border: 1px solid #ccc; padding-top: 10px; padding-bottom: 10px;" id="admin_panel">
                <div style="float: left;">
                    <strong>Admin Panel:</strong> Logged in as <%= fb_name current_user.facebook_id, :linked=>false %>, #<%= current_user.facebook_id %>.
                </div>
                <div style="float:left;width:5px;text-align:center;">&nbsp;</div>
                <div style="float:left;width:20px;text-align:center;">|</div>
                <div style="float: left;">
                    <%= link_to "manage users", users_path %>
                </div>
                <div style="float:left;width:20px;text-align:center;">|</div>
                <div style="float: left;">
                    <%= link_to "manage all pages", page_index_path %>
                </div>
                <% if current_user.is_admin %>
                    <div style="float:left;width:20px;text-align:center;">|</div>
                    <div style="float: left;">
                        <%= link_to "switch to puppet", spoof_path %>
                    </div>
                <% end %>
                <div style="float:left;width:20px;text-align:center;">|</div>
                <div style="float: left;">
                    <%= link_to "launch queue", future_page_queue_path %>
                </div>
                <div style="float:left;width:20px;text-align:center;">|</div>
                <div style="float: left;">
                    <%= fb_logout_link "logout", logout_path %>
                </div>
                <div style="float: right;">
                    <a href="javascript:closeAdminPanel()">X</a>
                </div>
            </div>
            <script type="text/javascript" charset="utf-8">
                function closeAdminPanel(){
                    $('admin_panel').hide();
                }
            </script>
        <% end %>
        
    <% end %>
    
  
  <div class="span-6">
      <div style='margin: 10px;margin-left:0;'>
          <%= link_to image_tag('logo-6.png'), home_path %>
      </div>
 </div>
 <div class="span-12" style="padding-top: 24px;">
     <%= link_to "POPULAR", home_path, :class=>"nav_link current" %>
     <%= link_to "SUBMIT", submit_path, :class=>"nav_link" %>
     <% if false %>
         <% if current_user %>
            <%= link_to "YOUR PAGES", profile_path, :class=>"nav_link" %>
         <% end %>
         <%= link_to "SUBMIT", submit_path, :class=>"nav_link" %>
         <% if current_user %>
            <%= fb_logout_link "LOGOUT", logout_path, :class=>"nav_link" %>
         <% else %>
    		<%= link_to "LOGIN", login_path, :class=>"nav_link" %>
    		<%= link_to "REGISTER", register_path, :class=>"nav_link" %>
    	 <% end %>
	 <% end %>
 </div>
 
 <% if false %>
 <div class="span-6 last" style="padding-top: 24px; text-align: right;">
      <%= link_to "GET THE BOOKMARKLET", tools_path, :class=>"nav_link" %>
 </div>
 <% end %>
 
<!-- Get Started Banner -->
<% unless current_user or @hide_banner %>
    <%= render :partial=>'/layouts/introBanner/introBanner' %>
<% end %>

  <div class="prepend-1 append-1 span-22 last" style="border-radius: 10px; background-color: #fff;">
      
    <div class="span-20 prepend-1 append-1 last">
      <% unless flash[:notice].blank? %>
        <div id="flash_message_container">
          <h3><span class="highlight"><%= flash[:notice] %></span></h3>
        </div>
      <% else %>
        &nbsp;
      <% end %>
    </div>
    
    <%= yield  %>
    
    <hr class="space" style="height: 30px;"/>
    

  </div>
  
  <hr class="space" />
  
</div>

<script type="text/javascript" charset="utf-8">
    fbSafe(function(){
        FB.Event.subscribe('edge.create', function(href, widget) {
            // It doesn't matter what was clicked at this point, just notify the server
            pingSrc = "<%= vote_cast_url %>?vote=" + encodeURIComponent(href);
            var s = document.createElement("script");
            s.setAttribute("src", pingSrc + "&c_buster=" + Math.floor(Math.random()*10000)); // Don't cache
            document.body.appendChild(s);
        });
    });
    <% if current_user and current_user.is_content_editor %>
        function boostScore(href){
            pingSrc = "<%= vote_cast_url %>?vote=" + encodeURIComponent(href);
            var s = document.createElement("script");
            s.setAttribute("src", pingSrc + "&boost=true&c_buster=" + Math.floor(Math.random()*10000)); // Don't cache
            document.body.appendChild(s);
        }
    <% end %>
</script>

<% else %>
	<!-- Empty Layout -->
	<%= yield %>
<% end %>


<script type="text/javascript">
var _sf_async_config={uid:11122,domain:"l.thelikestream.com"};
(function(){
  function loadChartbeat() {
    window._sf_endpt=(new Date()).getTime();
    var e = document.createElement('script');
    e.setAttribute('language', 'javascript');
    e.setAttribute('type', 'text/javascript');
    e.setAttribute('src',
       (("https:" == document.location.protocol) ? "https://s3.amazonaws.com/" : "http://") +
       "static.chartbeat.com/js/chartbeat.js");
    document.body.appendChild(e);
  }
  var oldonload = window.onload;
  window.onload = (typeof window.onload != 'function') ?
     loadChartbeat : function() { oldonload(); loadChartbeat(); };
})();

</script>

</body>
</html>